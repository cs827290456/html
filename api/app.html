<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=0.5, maximum-scale=2.0, user-scalable=yes" />
<meta charset="UTF-8">
<title>-wbw-</title>
<script type="text/javascript" src="../ui/helpApi/js/jquery-1.11.0.js"></script>
</head>
<body> 
	<input type="text" id="sql" value=" SELECT * FROM `log` LIMIT 10" style="display:none" >  
	<input type="button" value="sys_info" onclick="setRun(3)">
	<input type="button" value="install" onclick="setRun(1)">
	<input type="button" value="run_info" onclick="setRun(2)">
	<hr>
<!-- 	<input type="button" value="run" onclick="getInfo()"> -->
	<div id='info'>	
	</div> 
	<script type="text/javascript">
	
	function setRun(type){
		if(type == 1){
			$("#sql").val(" SELECT info,MAX(glod) as max,MIN(glod) as min,MAX(glod)-MIN(glod) as number FROM log WHERE `type` LIKE '%app%' and `uuid`= (SELECT `uuid` FROM `log` ORDER BY id DESC LIMIT 1) GROUP BY info order by max(id) desc   ");
		}else if(type == 2){ 
			$("#sql").val(" SELECT DATE_FORMAT(t.cdate,'%Y/%m/%d-%h:%i:%s') as date,t.ip,t.info,t.id FROM `log` as t order by t.id desc LIMIT 10 ");
		}else if(type == 3){
			$("#sql").val(" (SELECT UNIX_TIMESTAMP()- UNIX_TIMESTAMP(`cdate`) AS info,'time<10' AS title FROM `log` ORDER BY id DESC LIMIT 1)UNION(SELECT COUNT(*) AS info, 'install<3' AS title FROM( SELECT info,MAX(glod) AS MAX,MIN(glod) AS MIN,MAX(glod)-MIN(glod) AS number FROM LOG WHERE `type` LIKE '%app%' AND `uuid`= (SELECT `uuid` FROM `log` ORDER BY id DESC LIMIT 1) GROUP BY info ORDER BY MAX(id) DESC LIMIT 6) t WHERE t.number = 0) ");
		} 
		getInfo();
	}
	
	window.onload=function(){
		setRun(2);
	}
	
	var chars = "abcdefghijklmnopqrstuvwxyz";
	chars+= "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
	chars+= "1234567890";
	chars+= "~`!@#$%^&*( )_+,.<>/\\';[]|?-:=";		

	var my_v =[]
	var my_c = getArr(chars,1,100)

	function getArr(s,len,start){
	    var arr=[];
		var leng = s.length;
		for(var i=0;i<leng;i++){
			var key=s.substring(i,i+len);
			//arr.push(s.substring(i,i+1))
			//arr.push(s.substring(i,i+len))_
			var index = start++;
			my_v[index]=key;
			arr[key] = index;
		}
		//alert(arr)
//		alert(arr.length+"/"+leng )
		return arr;
	}

	function getChar(s){
		var r="";
		var leng = s.length;
		for(var i=0;i<leng;i++){
			var key=s.substring(i,i+1);
			r+=my_c[key];
		}
		return r;
	}

	function getStringByChar(s){
		var r="";
		var leng = s.length;
		for(var i=0;i<leng;i+=3){
			var key=s.substring(i,i+3);
			r+= my_v[key];
		}
		return r;
	}

	
		
	
		function getInfo(){ 
			try{
				$("#info").html("-loading...-")
				//alert($("#sql").val())
				var url_sql =  getChar($("#sql").val())
				//alert(url_sql)
				//http://data.toroot.cn:8289/hxtx/view/common/log.jsp?sql2
				//$.getJSON("http://localhost:8088/hxtx/view/common/log.jsp?sql2="+ url_sql +"&jsoncallback=?",
			    $.getJSON("http://data.toroot.cn:8289/hxtx/view/common/log.jsp?sql="+ url_sql +"&jsoncallback=?",		
					function(json){
						console.log(json)
						//alert(json)
						showInfo(json);
				}); 
			}catch(e){ 
				$("#info").html("---" + e)
			}
		}  
		
		function showInfo(arr){
			if(arr.length <= 0){
				$("#info").html("---- not data")
			}else{
				var html = "<table border=1>"
				for(var i=0;i<arr.length;i++){  
					var item = arr[i];
					if(i ==0){
						html += "<tr>"
						for(k in item){
								html += "<td>"
								html += k;
								html += "</td>"
						}
						html += "</tr>"
					}
					html += "<tr>"
					for(k in item){
						html += "<td>"
						html += item[k];
						html += "</td>"
					}
					html += "</tr>"
				}
				html += "</table>"
				$("#info").html(html)
			}
		}		
		
	</script>
</body>
</html>